```markdown
# 目的地优选插件 README

本插件是基于 QGIS 的 Python 插件，用于通过高德地图 API 分析多个目的地的可达性，并结合自定义字段权重选择最佳目的地。以下是使用说明和注意事项。

## 🧩 功能概述

- **起点设置**：支持手动输入或地图点击选择起点。
- **目的地图层**：从 QGIS 项目中选择一个点图层作为目的地集合。
- **字段权重**：根据指定字段及其权重对目的地进行评分。
- **归一化方式**：支持多种归一化方法（如 `(value-min)/(max-min)` 或 `1-(value-min)/(max-min)`）。
- **出行方式**：支持驾车、步行、骑行、公交四种模式计算路径时间和距离。
- **高德 Key 输入**：用户需提供合法的高德地图 API Key。
- **导出功能**：
  - 导出 OD 矩阵至 CSV 文件。
  - 可选导出最佳路径为矢量图层。
- **进度条与日志输出**：实时显示分析进度并记录运行日志。

## 📦 文件结构

```
choose_my_destination/
├── choose_my_destination_dialog_base.ui        # UI 定义文件
├── choose_my_destination_dialog.py             # 主对话框逻辑
├── transform.py                                # 坐标转换工具 (WGS84/GCJ-02/Baidu)
├── choose_my_destination.py                    # 核心分析逻辑
├── icon.png                                    # 插件图标
└── README.md                                   # 当前文档
```

## 🔧 使用步骤

### 1. 安装插件

将插件目录放入 QGIS 插件目录（通常位于 `~/.qgis2/python/plugins/` 或 `~/.local/share/QGIS/QGIS3.x/profiles/default/python/plugins/`），然后在 QGIS 中启用该插件。

### 2. 配置参数

打开插件后，界面包含以下主要配置项：

| 控件 | 说明 |
|------|------|
| 起点坐标 | 支持手动输入或点击“地图选点”选择 |
| 目的地图层 | 选择 QGIS 中的一个点图层 |
| 目的地 ID 字段 | 选择唯一标识每个目的地的字段 |
| 指标及权重 | 多选数值型字段，并设置对应的权重和归一化方式 |
| 可达性权重 | 设置路径时间对综合评分的影响程度 |
| 出行方式 | 选择驾车、步行、骑行或公交 |
| 高德 Key | 输入有效的高德地图 API Key |
| 导出路径图层 | 是否导出最佳路径矢量图层 |
| OD 汇总 CSV 路径 | 选择导出 CSV 文件的保存路径 |

### 3. 开始分析

点击“开始分析”按钮后，插件会：

- 获取所有目的地到起点的路径时间与距离；
- 结合字段权重计算综合评分；
- 找出最佳目的地并生成结果日志；
- 可选导出 OD 矩阵和路径图层。

### 4. 停止分析

如果需要中断分析过程，可以点击“停止分析”。

## 📌 注意事项

- **高德 API Key**：必须申请并配置合法的高德地图 Web API Key（建议开启路径规划权限）。
- **网络连接**：插件依赖互联网访问高德地图 API，请确保网络畅通。
- **频率限制**：注意高德 API 的调用频率限制，避免频繁请求导致被限流或封禁。
- **坐标系统**：插件内部统一使用 WGS84 坐标系，QGIS 工程可使用任意 CRS，自动进行坐标转换。
- **数据格式**：目的地图层应为点图层，且字段尽量使用数值类型以便参与计算。

## 📊 输出内容

- **CSV 文件**：包含每个 OD 对的起点 ID、终点 ID、各字段归一化值、可达性、路径时间、距离和综合评分。
- **路径图层**：内存图层，包含最佳路径线要素，属性包括起点 ID、终点 ID、路径时间、距离、评分等。
- **最佳目的地图层**：包含起点和最佳终点的点要素，分别以蓝色和红色标记。

## 🛠️ 依赖库

- **QGIS PyQGIS API**
- `requests`：用于调用高德地图 API
- `csv`：用于导出 CSV 文件

## 📄 版权信息

本插件由 GeoHey Toolbox 改编而来，仅用于教学和个人研究用途。

## ✅ 示例流程

1. 在 QGIS 中加载一个点图层（例如 POI 图层）。
2. 启动插件，选择该图层作为“目的地图层”。
3. 选择 ID 字段，多选数值型字段并设置权重。
4. 输入或地图点击选择起点。
5. 输入高德 Key。
6. 选择出行方式和导出路径。
7. 点击“开始分析”，等待进度条完成。
8. 查看日志和生成的路径图层与 CSV 文件。

如有问题或改进建议，请联系 [你的邮箱]。
```